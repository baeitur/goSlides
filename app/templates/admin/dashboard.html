{% extends "admin/base_admin.html" %}
{% block admin_content %}
<h1 class="font-heading font-bold text-2xl text-gray-900 mb-6">Dashboard</h1>
{% if active_year %}
<p class="text-gray-600 mb-6">Tahun aktif: <strong>{{ active_year.name }}</strong></p>

{% if stats %}
<div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
  <div class="bg-white rounded-2xl shadow-soft p-5 border border-gray-100">
    <p class="text-sm text-gray-500">Acara</p>
    <p class="font-heading font-bold text-2xl text-primary">{{ stats.total_activities }}</p>
  </div>
  <div class="bg-white rounded-2xl shadow-soft p-5 border border-gray-100">
    <p class="text-sm text-gray-500">Total pendaftar</p>
    <p class="font-heading font-bold text-2xl text-gray-900">{{ stats.total_registrants }}</p>
  </div>
  <div class="bg-white rounded-2xl shadow-soft p-5 border border-gray-100">
    <p class="text-sm text-gray-500">Terverifikasi</p>
    <p class="font-heading font-bold text-2xl text-green-600">{{ stats.verified_count }}</p>
  </div>
  <div class="bg-white rounded-2xl shadow-soft p-5 border border-gray-100">
    <p class="text-sm text-gray-500">Hadir</p>
    <p class="font-heading font-bold text-2xl text-accent">{{ stats.attended_count }}</p>
  </div>
</div>

<div class="grid lg:grid-cols-2 gap-8 mb-8">
  <div class="bg-white rounded-2xl shadow-soft p-6 border border-gray-100">
    <h3 class="font-heading font-semibold text-gray-800 mb-4">Pendaftaran per acara</h3>
    <canvas id="chartActivities" height="200"></canvas>
  </div>
  <div class="bg-white rounded-2xl shadow-soft p-6 border border-gray-100">
    <h3 class="font-heading font-semibold text-gray-800 mb-4">Pendaftaran 14 hari terakhir</h3>
    <canvas id="chartDays" height="200"></canvas>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
(function(){
  // Jinja template: stats akan digantikan JSON saat render
  var stats = {{ stats | tojson }};
  if (stats.activity_labels && stats.activity_labels.length) {
    new Chart(document.getElementById('chartActivities'), {
      type: 'bar',
      data: {
        labels: stats.activity_labels,
        datasets: [{ label: 'Registrants', data: stats.activity_counts, backgroundColor: '#1BA3A8', borderRadius: 8 }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
      }
    });
  }
  if (stats.day_labels && stats.day_labels.length) {
    new Chart(document.getElementById('chartDays'), {
      type: 'line',
      data: {
        labels: stats.day_labels.map(function(d){ return d.slice(5); }),
        datasets: [{ label: 'Registrations', data: stats.regs_per_day, borderColor: '#F4B23C', backgroundColor: 'rgba(244,178,60,0.1)', fill: true, tension: 0.3 }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
      }
    });
  }
})();
</script>
{% endif %}

<div class="mb-8">
  <h2 class="font-heading font-semibold text-lg text-gray-800 mb-4">Acara ({{ active_year.name }})</h2>
  {% if activities %}
  <div class="space-y-3">
    {% for act in activities %}
    <div class="flex flex-wrap items-center justify-between gap-4 bg-white rounded-xl shadow-soft p-4 border border-gray-100">
      <div>
        <a href="{{ url_for('admin.activity_edit', activity_id=act.id) }}" class="font-medium text-gray-900 hover:text-primary">{{ act.title }}</a>
        <span class="ml-2 text-sm text-gray-500">{{ act.status }} · {{ act.type }}</span>
      </div>
      <a href="{{ url_for('admin.registrants_list', activity_id=act.id) }}" class="text-sm text-primary hover:underline">
        {{ act.registrants.count() }} registrant(s)
      </a>
    </div>
    {% endfor %}
  </div>
  <a href="{{ url_for('admin.activities_list', year_id=active_year.id) }}" class="inline-block mt-4 text-primary font-medium hover:underline">Kelola acara →</a>
  {% else %}
  <p class="text-gray-500">Belum ada acara.</p>
  <a href="{{ url_for('admin.activities_list', year_id=active_year.id) }}" class="inline-block mt-2 text-primary font-medium">Tambah acara</a>
  {% endif %}
</div>
{% else %}
<p class="text-gray-600 mb-6">Belum ada tahun aktif. <a href="{{ url_for('admin.years_list') }}" class="text-primary font-medium">Kelola tahun</a></p>
{% endif %}
{% endblock %}
